<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>COLLAB</title>
        <link rel="stylesheet" href="resources/css/chart.css" type="text/css">
        <link rel="stylesheet" href="resources/css/bootstrap.min.css" type="text/css">
       <link rel="stylesheet" href="resources/css/bootstrap-responsive.css" type="text/css">
        <link rel="stylesheet" href="resources/css/style.css" type="text/css">
        <link rel="stylesheet" href="resources/css/jquery.dataTables.css" type="text/css">
                
        <script src="resources/js/jquery-1.10.2.min.js" type="text/javascript"></script>  
        <script src="resources/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="resources/js/jquery.dataTables.js"></script>
        <script src="resources/js/jquery.vticker.min.js"></script>
      <!-- <script src="http://code.highcharts.com/stock/highstock.js"></script>-->  
        <script src="resources/js/highcharts.js"></script>
        <script src="resources/js/highcharts-3d.js"></script>
        <script src="resources/js/jquery.vticker.min.js"></script>
        <script type="text/javascript" src="resources/js/exporting.js"></script>
        <script src="http://github.highcharts.com/master/modules/no-data-to-display.src.js"></script>
        <script type="text/javascript">
        
        $(document).ready(function(){
            var chart;
            var chartData;
            var imcount;
            var severity;
            var severityData;
           
            
        	$('body').append('<div id="loading"><div class="loaderbg"></div><div class="loader"></div></div>');
        	$('.loaderbg').css('height',$('body').height());
            
            $.ajax({
               	type:'GET',
               	url:'/Collab/collab/chart/IM',
               	contentType:'application/json',
               	dataType: "json",
               	success:function(data){
               		chartData=data;
               		imChart();
               		displayTable();
               		$('#loading').remove();
               	},
                error: function(){
                return true;
               },
             }); 
           
           function displayTable(){
        	   $('#imtable').show();
        	   $('#example').dataTable({
                   "aaData" : chartData,
                   "aoColumns" : [
                                  {
                               	   "mData" : "imNumber"
                                  },
                                  {
                               	   "mData" : "assignmentGroup"
                                  },
                                  {
                                   "mData" : "description"
                                  },
                                  {
                                   "mData" : "severity"
                                  }
                                  ]
                   });
                 }
           
        });
        
        function imChart(){
            $('#imdiv').highcharts({
                chart: {
                    options3d: {
        				enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                },
                title: {
                    text: 'IM COUNT'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 35,
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}'
                        }
                    }
                },
                series:(function(){
                	var series=[];
                    $.ajax({
                       	type:'GET',
                       	url:'/Collab/collab/chart/ImCount',
                       	contentType:'application/json',
                       	dataType: "json",
                        async: false,
                        cache: false,
                        timeout: 30000,
                       	success: function(data){ 
                        	var msg=[]; 
                        	
                        	$.each(data,function(key,obj){
                        		
                        		msg.push([
                        		  obj.assginmentGroup,
                        		  obj.imCount
                        		]);
                        		
                        	});
                        	
                        	series.push({type:'pie',name : 'IM Counts per group',data: msg});	        	                    	 
                        },
                       error: function(){
                        return true;
                       },
                     }); 
                  	return series;
                })()
            });
            }
        
        function severityCount(severity){
     	   alert(severity);
     	   $('#imdiv').highcharts({
              title: {
                  text: 'IM COUNT BASED ON SEVERITY'
              },
              tooltip: {
                  pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
              },
              plotOptions: {
                  pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      depth: 35,
                      dataLabels: {
                          enabled: true,
                          format: '{point.name}'
                      }
                  }
              },
              series:(function(){
              	var series=[];
                  $.ajax({
                     	type:'GET',
                     	url:'/Collab/collab/chart/'+severity,
                     	contentType:'application/json',
                     	dataType: "json",
                      async: false,
                      cache: false,
                      timeout: 30000,
                     	success: function(data){ 
                      	var msg=[]; 
                      	
                      	$.each(data,function(key,obj){
                      		
                      		msg.push([
                      		  obj.assignmentGroup,
                      		  obj.severityCount
                      		]);
                      		
                      	});
                      	
                      	series.push({type:'pie',name : 'IM Counts per group',data: msg});	        	                    	 
                      	
                      }
                   }); 
                	return series;
              })()
          });
        };
        
        function liveStream()
        {
        
        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });
    
        var chart;
        $('#imdiv').highcharts({
            chart: {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load : function() {
                        // set up the updating of the chart each second
                        var series = this.series;
                        setInterval(function() {
							var time=(new Date()).getTime();        	                        	
                        	$.ajax({
        	                    url: '/Collab/collab/chart/ImCount',
        	                    type: 'GET',
        	                    async: false,
        	                    cache: false,
        	                    timeout: 30000,
        	                    error: function(){
        	                        return true;
        	                    },
        	                    success: function(data){ 
        	                    	
        	                    	for(var counter=0;counter<data.length;counter++){
        	                    		var x =time + counter * data.length;
        	                    		var y=data[counter].count;  
        	                    		series[counter].addPoint([x,y],true,true);
        	                    	}	        	        	                    	        	                    	 
        	                    }
        	                });
                                
                        }, 20000);
                    }
                }
            },
            title: {
                text: 'IM TICKET COUNT'
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: 'Value'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                shared: true
            },
            legend: {
                layout: 'vertical',
                align: 'left',
                x: 120,
                verticalAlign: 'top',
                y: 80,
                floating: true,
                backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
            },
            exporting: {
                enabled: true,
            },
            series:(function(){
            	var series=[];
                $.ajax({
                   	type:'GET',
                   	url:'/Collab/collab/chart/ImCount',
                   	contentType:'application/json',
                   	dataType: "json",
                    async: false,
                    cache: false,
                    delay: 50000,
                   	success: function(data){
                    	$.each(data,function(key,obj){
                        	var msg=[]; 
                        	time = (new Date()).getTime();
                        	for( i = -999; i <= 0; i++) {
     	                       msg.push([
     	                            time + i * 1000,
     	                           0			
     	                        ]);
                    		}
                        	series.push({name:obj.assginmentGroup,data: msg});
                    	});	        	                    	 
                    },
                   error: function(){
                    return true;
                   },
                 }); 
              	return series;
            })()
        });
    };
        </script>
    </head>
    
    <body style="background: none repeat scroll 0 0 #F5F5DC;margin: 8px; padding: 0;">
        <div class="navbar-fixed-top startbootstrap-nav" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Welcome</a>
          </div>
          <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
              <li id="home"><a href="#" id="home" onClick="imChart();">Home</a></li>
               <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="sev">Severity<b class="caret"></b></a>
                 <ul class="dropdown-menu" id="severity">
                  <li><a href="#" onClick="severityCount('Low');">Low</a></li>
             	  <li><a href="#" onClick="severityCount('Medium');">Medium</a></li>
            	  <li><a href="#" onClick="severityCount('High');">High</a></li>
                </ul>
              </li>
              <li id="home"><a href="#" id="home" onClick="liveStream();">Ticket</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
               <li><a href="#" id="about">About</a></li>
               <li><a href="#" id="contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </div>
      <div id="container" >
      <!-- <div>DATA
        <select id="days">
         <option value="15">15</option>
         <option value="30">30</option>
        </select>
       </div>-->
       <div id="holder">
        <div id="imdiv"></div>
       </div>
       <div id="imtable">
        <table id="example">
         <thead>
         <th>IM NUMBER</th>
         <th>Assignment Group</th>
         <th>Description</th>
         <th>Severity</th>
         </thead>
        </table>
       </div> 
      </div>
    </body>
</html>
